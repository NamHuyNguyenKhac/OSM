<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marker Data List</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>Markers Data List</h2>
        <input type="text" id="searchInput" class="form-control" placeholder="Search by address...">
        <table class="table table-bordered mt-2" id="markersTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Name</th>
                    <th onclick="sortTable(1)">Coordinates</th>
                    <th onclick="sortTable(2)">Address</th>
                    <th onclick="sortTable(3)">Bedrooms</th>
                    <th onclick="sortTable(4)">Bathrooms</th>
                    <th onclick="sortTable(5)">Price (USD)</th>
                    <th onclick="sortTable(6)">Description</th>
                </tr>
            </thead>
            <tbody id="markersBody">
                <!-- Data rows will be dynamically inserted here -->
            </tbody>
        </table>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination"></ul>
        </nav>
    </div>

    <script>
        let markersData = [];
        const rowsPerPage = 5;
        let currentPage = 1;

        $(document).ready(function() {
            fetchMarkers();

            // Search functionality
            $('#searchInput').on('input', function() {
                currentPage = 1; // Reset to the first page on search
                renderTable();
            });
        });

        function fetchMarkers() {
            $.getJSON('/get_markers', function(data) {
                markersData = data;
                renderTable();
            });
        }

        function renderTable() {
            const searchValue = $('#searchInput').val().toLowerCase();
            const filteredData = markersData.filter(row => {
                return row.address.toLowerCase().includes(searchValue);
            });
            const totalRows = filteredData.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            const startRow = (currentPage - 1) * rowsPerPage;
            const endRow = startRow + rowsPerPage;
            const paginatedData = filteredData.slice(startRow, endRow);

            const markersBody = $('#markersBody');
            markersBody.empty();
            paginatedData.forEach(row => {
                markersBody.append(`
                    <tr>
                        <td>${row.name}</td>
                        <td>${row.coordinates}</td>
                        <td>${row.address}</td>
                        <td>${row.bedroom}</td>
                        <td>${row.bathroom}</td>
                        <td>${row.price}</td>
                        <td>${row.description}</td>
                    </tr>
                `);
            });

            renderPagination(totalRows, totalPages);
        }

        function renderPagination(totalRows, totalPages) {
            const pagination = $('#pagination');
            pagination.empty();

            for (let i = 1; i <= totalPages; i++) {
                pagination.append(`
                    <li class="page-item ${currentPage === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `);
            }
        }

        function changePage(page) {
            currentPage = page;
            renderTable();
        }

        function sortTable(columnIndex) {
            markersData.sort((a, b) => {
                const aValue = Object.values(a)[columnIndex].toString();
                const bValue = Object.values(b)[columnIndex].toString();
                return aValue.localeCompare(bValue);
            });
            renderTable();
        }
    </script>
</body>
</html>
